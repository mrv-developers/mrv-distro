<html>
<head>
<title>mrv.maya.util</title>
</head>
<body>
mrv.maya.util
<style>
.coverage pre {float: left; margin: 0px 1em; border: none;
               padding: 0px; }
.num pre { margin: 0px }
.nocov, .nocov pre {background-color: #faa}
.cov, .cov pre {background-color: #cfc}
div.coverage div { clear: both; height: 1.1em}
</style>
<div class="stats">
Covered: 326 lines<br/>
Missed: 71 lines<br/>
Skipped 190 lines<br/>
Percent: 82 %<br/>

</div>
<div class="coverage">
<div class="skip"><span class="num"><pre>  1</pre></span><pre># -*- coding: utf-8 -*-</pre></div>
<div class="cov"><span class="num"><pre>  2</pre></span><pre>&quot;&quot;&quot;All kinds of utility methods and classes that are used in more than one modules &quot;&quot;&quot;</pre></div>
<div class="cov"><span class="num"><pre>  3</pre></span><pre>__docformat__ = &quot;restructuredtext&quot;</pre></div>
<div class="skip"><span class="num"><pre>  4</pre></span><pre></pre></div>
<div class="cov"><span class="num"><pre>  5</pre></span><pre>import maya.mel as mm</pre></div>
<div class="cov"><span class="num"><pre>  6</pre></span><pre>import maya.cmds as cmds</pre></div>
<div class="cov"><span class="num"><pre>  7</pre></span><pre>import maya.OpenMaya as api</pre></div>
<div class="cov"><span class="num"><pre>  8</pre></span><pre>import mrv.util as util</pre></div>
<div class="cov"><span class="num"><pre>  9</pre></span><pre>from mrv.util import capitalize,uncapitalize</pre></div>
<div class="cov"><span class="num"><pre> 10</pre></span><pre>import networkx.exception as networkxexc</pre></div>
<div class="skip"><span class="num"><pre> 11</pre></span><pre></pre></div>
<div class="cov"><span class="num"><pre> 12</pre></span><pre>import traceback</pre></div>
<div class="skip"><span class="num"><pre> 13</pre></span><pre></pre></div>
<div class="cov"><span class="num"><pre> 14</pre></span><pre>import weakref</pre></div>
<div class="skip"><span class="num"><pre> 15</pre></span><pre></pre></div>
<div class="cov"><span class="num"><pre> 16</pre></span><pre>__all__ = (&quot;noneToList&quot;, &quot;isIterable&quot;, &quot;pythonToMel&quot;, &quot;makeEditOrQueryMethod&quot;, </pre></div>
<div class="cov"><span class="num"><pre> 17</pre></span><pre>           &quot;queryMethod&quot;, &quot;editMethod&quot;, &quot;propertyQE&quot;, &quot;Mel&quot;, &quot;OptionVarDict&quot;, </pre></div>
<div class="cov"><span class="num"><pre> 18</pre></span><pre>           &quot;optionvars&quot;, &quot;StandinClass&quot;, &quot;MetaClassCreator&quot;, &quot;CallbackEventBase&quot;, </pre></div>
<div class="cov"><span class="num"><pre> 19</pre></span><pre>           &quot;MEnumeration&quot;, &quot;notifyException&quot;)</pre></div>
<div class="skip"><span class="num"><pre> 20</pre></span><pre></pre></div>
<div class="skip"><span class="num"><pre> 21</pre></span><pre>#{ Utility Functions</pre></div>
<div class="cov"><span class="num"><pre> 22</pre></span><pre>def noneToList( res ):</pre></div>
<div class="cov"><span class="num"><pre> 23</pre></span><pre>	&quot;&quot;&quot;:return: list instead of None&quot;&quot;&quot;</pre></div>
<div class="cov"><span class="num"><pre> 24</pre></span><pre>	if res is None:</pre></div>
<div class="cov"><span class="num"><pre> 25</pre></span><pre>		return list()</pre></div>
<div class="cov"><span class="num"><pre> 26</pre></span><pre>	return res</pre></div>
<div class="skip"><span class="num"><pre> 27</pre></span><pre>	</pre></div>
<div class="cov"><span class="num"><pre> 28</pre></span><pre>def isIterable( obj ):</pre></div>
<div class="cov"><span class="num"><pre> 29</pre></span><pre>	return hasattr(obj,'__iter__') and not isinstance(obj,basestring)</pre></div>
<div class="skip"><span class="num"><pre> 30</pre></span><pre></pre></div>
<div class="cov"><span class="num"><pre> 31</pre></span><pre>def pythonToMel(arg):</pre></div>
<div class="cov"><span class="num"><pre> 32</pre></span><pre>	if isinstance(arg,basestring):</pre></div>
<div class="cov"><span class="num"><pre> 33</pre></span><pre>		return u'&quot;%s&quot;' % cmds.encodeString(arg)</pre></div>
<div class="cov"><span class="num"><pre> 34</pre></span><pre>	elif isIterable(arg):</pre></div>
<div class="nocov"><span class="num"><pre> 35</pre></span><pre>		return u'{%s}' % ','.join( map( pythonToMel, arg) )</pre></div>
<div class="cov"><span class="num"><pre> 36</pre></span><pre>	return unicode(arg)</pre></div>
<div class="skip"><span class="num"><pre> 37</pre></span><pre>#} END utility functions</pre></div>
<div class="skip"><span class="num"><pre> 38</pre></span><pre></pre></div>
<div class="skip"><span class="num"><pre> 39</pre></span><pre></pre></div>
<div class="skip"><span class="num"><pre> 40</pre></span><pre>#{ Decorator</pre></div>
<div class="skip"><span class="num"><pre> 41</pre></span><pre></pre></div>
<div class="cov"><span class="num"><pre> 42</pre></span><pre>def _logException(func, reraise):</pre></div>
<div class="cov"><span class="num"><pre> 43</pre></span><pre>	def wrapper(*args, **kwargs):</pre></div>
<div class="nocov"><span class="num"><pre> 44</pre></span><pre>		try:</pre></div>
<div class="nocov"><span class="num"><pre> 45</pre></span><pre>			return func(*args, **kwargs)</pre></div>
<div class="nocov"><span class="num"><pre> 46</pre></span><pre>		except Exception, e:</pre></div>
<div class="skip"><span class="num"><pre> 47</pre></span><pre>			# print a full stack trace - for now not using the log</pre></div>
<div class="nocov"><span class="num"><pre> 48</pre></span><pre>			if reraise:</pre></div>
<div class="nocov"><span class="num"><pre> 49</pre></span><pre>				traceback.print_exc()</pre></div>
<div class="skip"><span class="num"><pre> 50</pre></span><pre>			</pre></div>
<div class="nocov"><span class="num"><pre> 51</pre></span><pre>			if api.MGlobal.mayaState() == api.MGlobal.kInteractive:</pre></div>
<div class="nocov"><span class="num"><pre> 52</pre></span><pre>				import mrv.maya.ui as ui</pre></div>
<div class="nocov"><span class="num"><pre> 53</pre></span><pre>				msg = str(e)</pre></div>
<div class="nocov"><span class="num"><pre> 54</pre></span><pre>				if reraise:</pre></div>
<div class="nocov"><span class="num"><pre> 55</pre></span><pre>					msg += &quot;\n\nSee the script editor for details&quot;</pre></div>
<div class="nocov"><span class="num"><pre> 56</pre></span><pre>				ui.ChoiceDialog(	t=str(type(e)),</pre></div>
<div class="nocov"><span class="num"><pre> 57</pre></span><pre>									m=msg,</pre></div>
<div class="nocov"><span class="num"><pre> 58</pre></span><pre>									c=['Confirm'] ).choice()</pre></div>
<div class="skip"><span class="num"><pre> 59</pre></span><pre>			# END show popup</pre></div>
<div class="nocov"><span class="num"><pre> 60</pre></span><pre>			if reraise:</pre></div>
<div class="nocov"><span class="num"><pre> 61</pre></span><pre>				raise</pre></div>
<div class="skip"><span class="num"><pre> 62</pre></span><pre>	# END wrapper</pre></div>
<div class="cov"><span class="num"><pre> 63</pre></span><pre>	wrapper.__name__ = func.__name__</pre></div>
<div class="cov"><span class="num"><pre> 64</pre></span><pre>	return wrapper</pre></div>
<div class="skip"><span class="num"><pre> 65</pre></span><pre></pre></div>
<div class="cov"><span class="num"><pre> 66</pre></span><pre>def logException(func):</pre></div>
<div class="cov"><span class="num"><pre> 67</pre></span><pre>	&quot;&quot;&quot;Decorator which shows short exception information in a popup and a full</pre></div>
<div class="cov"><span class="num"><pre> 68</pre></span><pre>	stack trace to stdout. Finally the exception will be reraised&quot;&quot;&quot;</pre></div>
<div class="cov"><span class="num"><pre> 69</pre></span><pre>	return _logException(func, reraise=True)</pre></div>
<div class="skip"><span class="num"><pre> 70</pre></span><pre></pre></div>
<div class="cov"><span class="num"><pre> 71</pre></span><pre>def notifyException(func):</pre></div>
<div class="cov"><span class="num"><pre> 72</pre></span><pre>	&quot;&quot;&quot;As logException, but does not reraise on error. This is useful if you just </pre></div>
<div class="cov"><span class="num"><pre> 73</pre></span><pre>	want to see a popup, but not cause maya to remove the possibly problematic UI</pre></div>
<div class="cov"><span class="num"><pre> 74</pre></span><pre>	callback. Additionally, no stacktrace will be shown&quot;&quot;&quot;</pre></div>
<div class="cov"><span class="num"><pre> 75</pre></span><pre>	return _logException(func, reraise=False)</pre></div>
<div class="skip"><span class="num"><pre> 76</pre></span><pre></pre></div>
<div class="skip"><span class="num"><pre> 77</pre></span><pre>#} END decorator</pre></div>
<div class="skip"><span class="num"><pre> 78</pre></span><pre></pre></div>
<div class="skip"><span class="num"><pre> 79</pre></span><pre>#{ MEL Function Wrappers</pre></div>
<div class="skip"><span class="num"><pre> 80</pre></span><pre></pre></div>
<div class="cov"><span class="num"><pre> 81</pre></span><pre>def makeEditOrQueryMethod( inCmd, flag, isEdit=False, methodName=None ):</pre></div>
<div class="cov"><span class="num"><pre> 82</pre></span><pre>	&quot;&quot;&quot;Create a function calling inFunc with an edit or query flag set.</pre></div>
<div class="skip"><span class="num"><pre> 83</pre></span><pre>	</pre></div>
<div class="cov"><span class="num"><pre> 84</pre></span><pre>	:note: THIS CODE HAS BEEN DUPLICATED TO `mrv.maya.ui.util` !</pre></div>
<div class="cov"><span class="num"><pre> 85</pre></span><pre>	:param inCmd: maya command to call</pre></div>
<div class="cov"><span class="num"><pre> 86</pre></span><pre>	:param flag: name of the query or edit flag</pre></div>
<div class="cov"><span class="num"><pre> 87</pre></span><pre>	:param isEdit: If not False, the method returned will be an edit function</pre></div>
<div class="cov"><span class="num"><pre> 88</pre></span><pre>	:param methodName: the name of the method returned, defaults to inCmd name  &quot;&quot;&quot;</pre></div>
<div class="skip"><span class="num"><pre> 89</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre> 90</pre></span><pre>	func = None</pre></div>
<div class="nocov"><span class="num"><pre> 91</pre></span><pre>	if isEdit:</pre></div>
<div class="nocov"><span class="num"><pre> 92</pre></span><pre>		def editFunc(self, val, **kwargs):</pre></div>
<div class="nocov"><span class="num"><pre> 93</pre></span><pre>			kwargs[ 'edit' ] = True</pre></div>
<div class="nocov"><span class="num"><pre> 94</pre></span><pre>			kwargs[ flag ] = val</pre></div>
<div class="nocov"><span class="num"><pre> 95</pre></span><pre>			return inCmd( self, **kwargs )</pre></div>
<div class="skip"><span class="num"><pre> 96</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre> 97</pre></span><pre>		func = editFunc</pre></div>
<div class="skip"><span class="num"><pre> 98</pre></span><pre>	# END if edit</pre></div>
<div class="nocov"><span class="num"><pre> 99</pre></span><pre>	else:</pre></div>
<div class="nocov"><span class="num"><pre>100</pre></span><pre>		def queryFunc(self, **kwargs):</pre></div>
<div class="nocov"><span class="num"><pre>101</pre></span><pre>			kwargs[ 'query' ] = True</pre></div>
<div class="nocov"><span class="num"><pre>102</pre></span><pre>			kwargs[ flag ] = True</pre></div>
<div class="nocov"><span class="num"><pre>103</pre></span><pre>			return inCmd( self, **kwargs )</pre></div>
<div class="skip"><span class="num"><pre>104</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>105</pre></span><pre>		func = queryFunc</pre></div>
<div class="skip"><span class="num"><pre>106</pre></span><pre>	# END if query</pre></div>
<div class="skip"><span class="num"><pre>107</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>108</pre></span><pre>	if not methodName:</pre></div>
<div class="nocov"><span class="num"><pre>109</pre></span><pre>		methodName = flag</pre></div>
<div class="nocov"><span class="num"><pre>110</pre></span><pre>	func.__name__ = methodName</pre></div>
<div class="skip"><span class="num"><pre>111</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>112</pre></span><pre>	return func</pre></div>
<div class="skip"><span class="num"><pre>113</pre></span><pre></pre></div>
<div class="cov"><span class="num"><pre>114</pre></span><pre>def queryMethod( inCmd, flag, methodName = None ):</pre></div>
<div class="cov"><span class="num"><pre>115</pre></span><pre>	&quot;&quot;&quot; Shorthand query version of makeEditOrQueryMethod &quot;&quot;&quot;</pre></div>
<div class="nocov"><span class="num"><pre>116</pre></span><pre>	return makeEditOrQueryMethod( inCmd, flag, isEdit=False, methodName=methodName )</pre></div>
<div class="skip"><span class="num"><pre>117</pre></span><pre></pre></div>
<div class="cov"><span class="num"><pre>118</pre></span><pre>def editMethod( inCmd, flag, methodName = None ):</pre></div>
<div class="cov"><span class="num"><pre>119</pre></span><pre>	&quot;&quot;&quot; Shorthand edit version of makeEditOrQueryMethod &quot;&quot;&quot;</pre></div>
<div class="nocov"><span class="num"><pre>120</pre></span><pre>	return makeEditOrQueryMethod( inCmd, flag, isEdit=True, methodName=methodName )</pre></div>
<div class="skip"><span class="num"><pre>121</pre></span><pre></pre></div>
<div class="cov"><span class="num"><pre>122</pre></span><pre>def propertyQE( inCmd, flag, methodName = None ):</pre></div>
<div class="cov"><span class="num"><pre>123</pre></span><pre>	&quot;&quot;&quot; Shorthand for simple query and edit properties &quot;&quot;&quot;</pre></div>
<div class="nocov"><span class="num"><pre>124</pre></span><pre>	editFunc = editMethod( inCmd, flag, methodName = methodName )</pre></div>
<div class="nocov"><span class="num"><pre>125</pre></span><pre>	queryFunc = queryMethod( inCmd, flag, methodName = methodName )</pre></div>
<div class="nocov"><span class="num"><pre>126</pre></span><pre>	return property( queryFunc, editFunc )</pre></div>
<div class="skip"><span class="num"><pre>127</pre></span><pre></pre></div>
<div class="skip"><span class="num"><pre>128</pre></span><pre>#} END mel function wrappers</pre></div>
<div class="skip"><span class="num"><pre>129</pre></span><pre></pre></div>
<div class="skip"><span class="num"><pre>130</pre></span><pre></pre></div>
<div class="skip"><span class="num"><pre>131</pre></span><pre>#{ Utitliy Classes</pre></div>
<div class="skip"><span class="num"><pre>132</pre></span><pre></pre></div>
<div class="cov"><span class="num"><pre>133</pre></span><pre>class Mel(util.Singleton):</pre></div>
<div class="cov"><span class="num"><pre>134</pre></span><pre>	&quot;&quot;&quot;This class is a necessity for calling mel scripts from python. It allows scripts to be called</pre></div>
<div class="cov"><span class="num"><pre>135</pre></span><pre>	in a cleaner fashion, by automatically formatting python arguments into a string</pre></div>
<div class="cov"><span class="num"><pre>136</pre></span><pre>	which is executed via maya.mel.eval().</pre></div>
<div class="skip"><span class="num"><pre>137</pre></span><pre></pre></div>
<div class="cov"><span class="num"><pre>138</pre></span><pre>	:note: originated from pymel, added customizations  &quot;&quot;&quot;</pre></div>
<div class="skip"><span class="num"><pre>139</pre></span><pre></pre></div>
<div class="cov"><span class="num"><pre>140</pre></span><pre>	def __getattr__(self, command):</pre></div>
<div class="cov"><span class="num"><pre>141</pre></span><pre>		&quot;&quot;&quot;Only for instances of this class - call methods directly as if they where</pre></div>
<div class="cov"><span class="num"><pre>142</pre></span><pre>		attributes &quot;&quot;&quot;</pre></div>
<div class="cov"><span class="num"><pre>143</pre></span><pre>		if command.startswith('__') and command.endswith('__'):</pre></div>
<div class="nocov"><span class="num"><pre>144</pre></span><pre>			return self.__dict__[command]</pre></div>
<div class="cov"><span class="num"><pre>145</pre></span><pre>		def _call(*args):</pre></div>
<div class="skip"><span class="num"><pre>146</pre></span><pre></pre></div>
<div class="cov"><span class="num"><pre>147</pre></span><pre>			strArgs = map( pythonToMel, args)</pre></div>
<div class="skip"><span class="num"><pre>148</pre></span><pre></pre></div>
<div class="cov"><span class="num"><pre>149</pre></span><pre>			cmd = '%s(%s)' % ( command, ','.join( strArgs ) )</pre></div>
<div class="cov"><span class="num"><pre>150</pre></span><pre>			try:</pre></div>
<div class="cov"><span class="num"><pre>151</pre></span><pre>				return mm.eval(cmd)</pre></div>
<div class="nocov"><span class="num"><pre>152</pre></span><pre>			except RuntimeError, msg:</pre></div>
<div class="nocov"><span class="num"><pre>153</pre></span><pre>				info = self.whatIs( command )</pre></div>
<div class="nocov"><span class="num"><pre>154</pre></span><pre>				if info.startswith( 'Presumed Mel procedure'):</pre></div>
<div class="nocov"><span class="num"><pre>155</pre></span><pre>					raise NameError, 'Unknown Mel procedure'</pre></div>
<div class="nocov"><span class="num"><pre>156</pre></span><pre>				raise RuntimeError, msg</pre></div>
<div class="skip"><span class="num"><pre>157</pre></span><pre></pre></div>
<div class="cov"><span class="num"><pre>158</pre></span><pre>		return _call</pre></div>
<div class="skip"><span class="num"><pre>159</pre></span><pre></pre></div>
<div class="cov"><span class="num"><pre>160</pre></span><pre>	@staticmethod</pre></div>
<div class="cov"><span class="num"><pre>161</pre></span><pre>	def call( command, *args ):</pre></div>
<div class="cov"><span class="num"><pre>162</pre></span><pre>		&quot;&quot;&quot; Call a mel script , very simpilar to Mel.myscript( args )</pre></div>
<div class="skip"><span class="num"><pre>163</pre></span><pre>		</pre></div>
<div class="cov"><span class="num"><pre>164</pre></span><pre>		:todo: more docs &quot;&quot;&quot;</pre></div>
<div class="cov"><span class="num"><pre>165</pre></span><pre>		strArgs = map( pythonToMel, args)</pre></div>
<div class="skip"><span class="num"><pre>166</pre></span><pre></pre></div>
<div class="cov"><span class="num"><pre>167</pre></span><pre>		cmd = '%s(%s)' % ( command, ','.join( strArgs ) )</pre></div>
<div class="skip"><span class="num"><pre>168</pre></span><pre></pre></div>
<div class="cov"><span class="num"><pre>169</pre></span><pre>		try:</pre></div>
<div class="cov"><span class="num"><pre>170</pre></span><pre>			return mm.eval(cmd)</pre></div>
<div class="nocov"><span class="num"><pre>171</pre></span><pre>		except RuntimeError, msg:</pre></div>
<div class="nocov"><span class="num"><pre>172</pre></span><pre>			info = Mel.call( &quot;whatIs&quot;, command )</pre></div>
<div class="nocov"><span class="num"><pre>173</pre></span><pre>			if info.startswith( 'Presumed Mel procedure'):</pre></div>
<div class="nocov"><span class="num"><pre>174</pre></span><pre>				raise NameError, ( 'Unknown Mel procedure: ' + cmd )</pre></div>
<div class="nocov"><span class="num"><pre>175</pre></span><pre>			raise RuntimeError, msg</pre></div>
<div class="skip"><span class="num"><pre>176</pre></span><pre></pre></div>
<div class="cov"><span class="num"><pre>177</pre></span><pre>	@staticmethod</pre></div>
<div class="cov"><span class="num"><pre>178</pre></span><pre>	def mprint(*args):</pre></div>
<div class="cov"><span class="num"><pre>179</pre></span><pre>		&quot;&quot;&quot;mel print command in case the python print command doesn't cut it. i have noticed that python print does not appear</pre></div>
<div class="cov"><span class="num"><pre>180</pre></span><pre>		in certain output, such as the rush render-queue manager.&quot;&quot;&quot;</pre></div>
<div class="nocov"><span class="num"><pre>181</pre></span><pre>		mm.eval( r&quot;&quot;&quot;print (%s);&quot;&quot;&quot; % pythonToMel( ' '.join( map( str, args))) + '\n' )</pre></div>
<div class="skip"><span class="num"><pre>182</pre></span><pre></pre></div>
<div class="cov"><span class="num"><pre>183</pre></span><pre>	@staticmethod</pre></div>
<div class="cov"><span class="num"><pre>184</pre></span><pre>	def eval( command ):</pre></div>
<div class="cov"><span class="num"><pre>185</pre></span><pre>		&quot;&quot;&quot; same as maya.mel eval &quot;&quot;&quot;</pre></div>
<div class="cov"><span class="num"><pre>186</pre></span><pre>		return mm.eval( command )</pre></div>
<div class="skip"><span class="num"><pre>187</pre></span><pre></pre></div>
<div class="cov"><span class="num"><pre>188</pre></span><pre>	@staticmethod</pre></div>
<div class="cov"><span class="num"><pre>189</pre></span><pre>	def _melprint( cmd, msg ):</pre></div>
<div class="nocov"><span class="num"><pre>190</pre></span><pre>		mm.eval( &quot;&quot;&quot;%s %s&quot;&quot;&quot; % ( cmd, pythonToMel( msg ) ) )</pre></div>
<div class="skip"><span class="num"><pre>191</pre></span><pre></pre></div>
<div class="cov"><span class="num"><pre>192</pre></span><pre>	error = staticmethod( lambda *args: Mel._melprint( &quot;error&quot;, *args ) )</pre></div>
<div class="cov"><span class="num"><pre>193</pre></span><pre>	trace = staticmethod( lambda *args: Mel._melprint( &quot;trace&quot;, *args ) )</pre></div>
<div class="cov"><span class="num"><pre>194</pre></span><pre>	info = staticmethod( lambda *args: Mel._melprint( &quot;print&quot;, *args ) )</pre></div>
<div class="skip"><span class="num"><pre>195</pre></span><pre></pre></div>
<div class="skip"><span class="num"><pre>196</pre></span><pre></pre></div>
<div class="cov"><span class="num"><pre>197</pre></span><pre>class OptionVarDict( util.Singleton ):</pre></div>
<div class="cov"><span class="num"><pre>198</pre></span><pre>	&quot;&quot;&quot;	 A singleton dictionary-like class for accessing and modifying optionVars.</pre></div>
<div class="skip"><span class="num"><pre>199</pre></span><pre>	</pre></div>
<div class="cov"><span class="num"><pre>200</pre></span><pre>	:note: Idea and base Implementation from PyMel, modified to adapt to mrv &quot;&quot;&quot;</pre></div>
<div class="cov"><span class="num"><pre>201</pre></span><pre>	class OptionVarList(tuple):</pre></div>
<div class="cov"><span class="num"><pre>202</pre></span><pre>		def __new__( cls, key, val ):</pre></div>
<div class="cov"><span class="num"><pre>203</pre></span><pre>			&quot;&quot;&quot;modify constructor to work with tuple&quot;&quot;&quot;</pre></div>
<div class="cov"><span class="num"><pre>204</pre></span><pre>			newinstpreinit = tuple.__new__( cls, val )</pre></div>
<div class="cov"><span class="num"><pre>205</pre></span><pre>			newinstpreinit.key = key</pre></div>
<div class="cov"><span class="num"><pre>206</pre></span><pre>			return newinstpreinit</pre></div>
<div class="skip"><span class="num"><pre>207</pre></span><pre></pre></div>
<div class="cov"><span class="num"><pre>208</pre></span><pre>		def appendVar( self, val ):</pre></div>
<div class="cov"><span class="num"><pre>209</pre></span><pre>			&quot;&quot;&quot; values appended to the OptionVarList with this method will be </pre></div>
<div class="cov"><span class="num"><pre>210</pre></span><pre>			added to the Maya optionVar at the key denoted by self.key. &quot;&quot;&quot;</pre></div>
<div class="nocov"><span class="num"><pre>211</pre></span><pre>			if isinstance( val, basestring):</pre></div>
<div class="nocov"><span class="num"><pre>212</pre></span><pre>				return cmds.optionVar( stringValueAppend=[self.key,unicode(val)] )</pre></div>
<div class="nocov"><span class="num"><pre>213</pre></span><pre>			if isinstance( val, (bool,int) ):</pre></div>
<div class="nocov"><span class="num"><pre>214</pre></span><pre>				return cmds.optionVar( intValueAppend=[self.key,int(val)] )</pre></div>
<div class="nocov"><span class="num"><pre>215</pre></span><pre>			if isinstance( val, float):</pre></div>
<div class="nocov"><span class="num"><pre>216</pre></span><pre>				return cmds.optionVar( floatValueAppend=[self.key,val] )</pre></div>
<div class="skip"><span class="num"><pre>217</pre></span><pre></pre></div>
<div class="skip"><span class="num"><pre>218</pre></span><pre></pre></div>
<div class="cov"><span class="num"><pre>219</pre></span><pre>	def __contains__(self, key):</pre></div>
<div class="cov"><span class="num"><pre>220</pre></span><pre>		return cmds.optionVar( exists=key )</pre></div>
<div class="skip"><span class="num"><pre>221</pre></span><pre></pre></div>
<div class="cov"><span class="num"><pre>222</pre></span><pre>	def __getitem__(self, key):</pre></div>
<div class="cov"><span class="num"><pre>223</pre></span><pre>		if key not in self:</pre></div>
<div class="cov"><span class="num"><pre>224</pre></span><pre>			raise KeyError(&quot;OptionVar named %s did not exist&quot; % key)</pre></div>
<div class="skip"><span class="num"><pre>225</pre></span><pre>		# END raise if k not in d</pre></div>
<div class="skip"><span class="num"><pre>226</pre></span><pre>		</pre></div>
<div class="cov"><span class="num"><pre>227</pre></span><pre>		val = cmds.optionVar( q=key )</pre></div>
<div class="cov"><span class="num"><pre>228</pre></span><pre>		if isinstance(val, list):</pre></div>
<div class="cov"><span class="num"><pre>229</pre></span><pre>			val = self.OptionVarList( key, val )</pre></div>
<div class="cov"><span class="num"><pre>230</pre></span><pre>		return val</pre></div>
<div class="skip"><span class="num"><pre>231</pre></span><pre></pre></div>
<div class="cov"><span class="num"><pre>232</pre></span><pre>	def __setitem__(self,key,val):</pre></div>
<div class="cov"><span class="num"><pre>233</pre></span><pre>		if isinstance( val, basestring):</pre></div>
<div class="cov"><span class="num"><pre>234</pre></span><pre>			return cmds.optionVar( stringValue=[key,unicode(val)] )</pre></div>
<div class="cov"><span class="num"><pre>235</pre></span><pre>		if isinstance( val, (int,bool)):</pre></div>
<div class="cov"><span class="num"><pre>236</pre></span><pre>			return cmds.optionVar( intValue=[key,int(val)] )</pre></div>
<div class="cov"><span class="num"><pre>237</pre></span><pre>		if isinstance( val, float):</pre></div>
<div class="cov"><span class="num"><pre>238</pre></span><pre>			return cmds.optionVar( floatValue=[key,val] )</pre></div>
<div class="skip"><span class="num"><pre>239</pre></span><pre></pre></div>
<div class="cov"><span class="num"><pre>240</pre></span><pre>		if isinstance( val, (list,tuple) ):</pre></div>
<div class="cov"><span class="num"><pre>241</pre></span><pre>			if len(val) == 0:</pre></div>
<div class="nocov"><span class="num"><pre>242</pre></span><pre>				return cmds.optionVar( clearArray=key )</pre></div>
<div class="skip"><span class="num"><pre>243</pre></span><pre></pre></div>
<div class="cov"><span class="num"><pre>244</pre></span><pre>			if isinstance( val[0], basestring):</pre></div>
<div class="cov"><span class="num"><pre>245</pre></span><pre>				cmds.optionVar( stringValue=[key,unicode(val[0])] ) # force to this datatype</pre></div>
<div class="cov"><span class="num"><pre>246</pre></span><pre>				for elem in val[1:]:</pre></div>
<div class="cov"><span class="num"><pre>247</pre></span><pre>					cmds.optionVar( stringValueAppend=[key,unicode(elem)] )</pre></div>
<div class="cov"><span class="num"><pre>248</pre></span><pre>				return</pre></div>
<div class="skip"><span class="num"><pre>249</pre></span><pre></pre></div>
<div class="cov"><span class="num"><pre>250</pre></span><pre>			if isinstance( val[0], (int,bool)):</pre></div>
<div class="cov"><span class="num"><pre>251</pre></span><pre>				cmds.optionVar(	 intValue=[key,int(val[0])] ) # force to this datatype</pre></div>
<div class="cov"><span class="num"><pre>252</pre></span><pre>				for elem in val[1:]:</pre></div>
<div class="cov"><span class="num"><pre>253</pre></span><pre>					cmds.optionVar( intValueAppend=[key,int(elem)] )</pre></div>
<div class="cov"><span class="num"><pre>254</pre></span><pre>				return</pre></div>
<div class="skip"><span class="num"><pre>255</pre></span><pre></pre></div>
<div class="cov"><span class="num"><pre>256</pre></span><pre>			if isinstance( val[0], float):</pre></div>
<div class="cov"><span class="num"><pre>257</pre></span><pre>				cmds.optionVar( floatValue=[key,val[0]] ) # force to this datatype</pre></div>
<div class="cov"><span class="num"><pre>258</pre></span><pre>				for elem in val[1:]:</pre></div>
<div class="cov"><span class="num"><pre>259</pre></span><pre>					cmds.optionVar( floatValueAppend=[key,float(elem)] )</pre></div>
<div class="cov"><span class="num"><pre>260</pre></span><pre>				return</pre></div>
<div class="skip"><span class="num"><pre>261</pre></span><pre></pre></div>
<div class="nocov"><span class="num"><pre>262</pre></span><pre>		raise TypeError, 'unsupported datatype: strings, ints, float, lists, and their subclasses are supported'</pre></div>
<div class="skip"><span class="num"><pre>263</pre></span><pre></pre></div>
<div class="cov"><span class="num"><pre>264</pre></span><pre>	def __delitem__( self, key ):</pre></div>
<div class="cov"><span class="num"><pre>265</pre></span><pre>		&quot;&quot;&quot;Delete the optionvar identified by key&quot;&quot;&quot;</pre></div>
<div class="cov"><span class="num"><pre>266</pre></span><pre>		cmds.optionVar( rm = str( key ) )</pre></div>
<div class="skip"><span class="num"><pre>267</pre></span><pre></pre></div>
<div class="cov"><span class="num"><pre>268</pre></span><pre>	def keys(self):</pre></div>
<div class="cov"><span class="num"><pre>269</pre></span><pre>		return cmds.optionVar( list=True )</pre></div>
<div class="skip"><span class="num"><pre>270</pre></span><pre></pre></div>
<div class="cov"><span class="num"><pre>271</pre></span><pre>	def iterkeys( self ):</pre></div>
<div class="cov"><span class="num"><pre>272</pre></span><pre>		&quot;&quot;&quot;:return: iterator to option var names&quot;&quot;&quot;</pre></div>
<div class="cov"><span class="num"><pre>273</pre></span><pre>		return iter( self.keys() )</pre></div>
<div class="skip"><span class="num"><pre>274</pre></span><pre></pre></div>
<div class="cov"><span class="num"><pre>275</pre></span><pre>	def itervalues( self ):</pre></div>
<div class="cov"><span class="num"><pre>276</pre></span><pre>		&quot;&quot;&quot;:return: iterator to optionvar values&quot;&quot;&quot;</pre></div>
<div class="cov"><span class="num"><pre>277</pre></span><pre>		for key in self.iterkeys():</pre></div>
<div class="cov"><span class="num"><pre>278</pre></span><pre>			yield self[ key ]</pre></div>
<div class="skip"><span class="num"><pre>279</pre></span><pre></pre></div>
<div class="cov"><span class="num"><pre>280</pre></span><pre>	def iteritems( self ):</pre></div>
<div class="cov"><span class="num"><pre>281</pre></span><pre>		&quot;&quot;&quot;:return: iterators to tuple of key,value pairs&quot;&quot;&quot;</pre></div>
<div class="cov"><span class="num"><pre>282</pre></span><pre>		for key in self.iterkeys():</pre></div>
<div class="cov"><span class="num"><pre>283</pre></span><pre>			yield ( key, self[ key ] )</pre></div>
<div class="skip"><span class="num"><pre>284</pre></span><pre></pre></div>
<div class="cov"><span class="num"><pre>285</pre></span><pre>	def get(self, key, default=None):</pre></div>
<div class="nocov"><span class="num"><pre>286</pre></span><pre>		if self.has_key(key):</pre></div>
<div class="nocov"><span class="num"><pre>287</pre></span><pre>			return self[key]</pre></div>
<div class="nocov"><span class="num"><pre>288</pre></span><pre>		else:</pre></div>
<div class="nocov"><span class="num"><pre>289</pre></span><pre>			return default</pre></div>
<div class="skip"><span class="num"><pre>290</pre></span><pre></pre></div>
<div class="cov"><span class="num"><pre>291</pre></span><pre>	def has_key(self, key):</pre></div>
<div class="cov"><span class="num"><pre>292</pre></span><pre>		return cmds.optionVar( exists=key )</pre></div>
<div class="skip"><span class="num"><pre>293</pre></span><pre></pre></div>
<div class="cov"><span class="num"><pre>294</pre></span><pre>	def pop(self, key):</pre></div>
<div class="cov"><span class="num"><pre>295</pre></span><pre>		val = self[ key ]</pre></div>
<div class="cov"><span class="num"><pre>296</pre></span><pre>		del( self[ key ] )</pre></div>
<div class="cov"><span class="num"><pre>297</pre></span><pre>		return val</pre></div>
<div class="skip"><span class="num"><pre>298</pre></span><pre></pre></div>
<div class="skip"><span class="num"><pre>299</pre></span><pre></pre></div>
<div class="skip"><span class="num"><pre>300</pre></span><pre># use it as singleton</pre></div>
<div class="cov"><span class="num"><pre>301</pre></span><pre>optionvars = OptionVarDict()</pre></div>
<div class="skip"><span class="num"><pre>302</pre></span><pre></pre></div>
<div class="skip"><span class="num"><pre>303</pre></span><pre>#} END utility classes</pre></div>
<div class="skip"><span class="num"><pre>304</pre></span><pre></pre></div>
<div class="skip"><span class="num"><pre>305</pre></span><pre></pre></div>
<div class="skip"><span class="num"><pre>306</pre></span><pre>#{ API Utilities Classes</pre></div>
<div class="skip"><span class="num"><pre>307</pre></span><pre></pre></div>
<div class="cov"><span class="num"><pre>308</pre></span><pre>class StandinClass( object ):</pre></div>
<div class="cov"><span class="num"><pre>309</pre></span><pre>	&quot;&quot;&quot; Simple Function Object allowing to embed the name of the type as well as</pre></div>
<div class="cov"><span class="num"><pre>310</pre></span><pre>	the metaclass object supposed to create the actual class. It mus be able to completely</pre></div>
<div class="cov"><span class="num"><pre>311</pre></span><pre>	create the given class.</pre></div>
<div class="skip"><span class="num"><pre>312</pre></span><pre>	</pre></div>
<div class="cov"><span class="num"><pre>313</pre></span><pre>	:note: Use it at placeholder for classes that are to be created on first call, without</pre></div>
<div class="cov"><span class="num"><pre>314</pre></span><pre>		vasting large amounts of memory if one wants to precreate them.&quot;&quot;&quot;</pre></div>
<div class="cov"><span class="num"><pre>315</pre></span><pre>	__slots__ = ( &quot;clsname&quot;, &quot;classcreator&quot;, &quot;_createdClass&quot; )</pre></div>
<div class="skip"><span class="num"><pre>316</pre></span><pre>	</pre></div>
<div class="cov"><span class="num"><pre>317</pre></span><pre>	def __init__( self, classname, classcreator=type ):</pre></div>
<div class="cov"><span class="num"><pre>318</pre></span><pre>		self.clsname = classname</pre></div>
<div class="cov"><span class="num"><pre>319</pre></span><pre>		self.classcreator = classcreator</pre></div>
<div class="cov"><span class="num"><pre>320</pre></span><pre>		self._createdClass = None</pre></div>
<div class="skip"><span class="num"><pre>321</pre></span><pre></pre></div>
<div class="cov"><span class="num"><pre>322</pre></span><pre>	def createCls( self ):</pre></div>
<div class="cov"><span class="num"><pre>323</pre></span><pre>		&quot;&quot;&quot; Create the class of type self.clsname using our classcreator - can only be called once !</pre></div>
<div class="skip"><span class="num"><pre>324</pre></span><pre>		</pre></div>
<div class="cov"><span class="num"><pre>325</pre></span><pre>		:return : the newly created class&quot;&quot;&quot;</pre></div>
<div class="cov"><span class="num"><pre>326</pre></span><pre>		if self._createdClass is None:</pre></div>
<div class="cov"><span class="num"><pre>327</pre></span><pre>			self._createdClass = self.classcreator( self.clsname, tuple(), {} )</pre></div>
<div class="skip"><span class="num"><pre>328</pre></span><pre></pre></div>
<div class="cov"><span class="num"><pre>329</pre></span><pre>		return self._createdClass</pre></div>
<div class="skip"><span class="num"><pre>330</pre></span><pre></pre></div>
<div class="cov"><span class="num"><pre>331</pre></span><pre>	def __call__( self, *args, **kwargs ):</pre></div>
<div class="cov"><span class="num"><pre>332</pre></span><pre>		newcls = self.createCls( )</pre></div>
<div class="cov"><span class="num"><pre>333</pre></span><pre>		return newcls( *args, **kwargs )</pre></div>
<div class="skip"><span class="num"><pre>334</pre></span><pre></pre></div>
<div class="skip"><span class="num"><pre>335</pre></span><pre></pre></div>
<div class="cov"><span class="num"><pre>336</pre></span><pre>class MetaClassCreator( type ):</pre></div>
<div class="cov"><span class="num"><pre>337</pre></span><pre>	&quot;&quot;&quot; Builds the base hierarchy for the given classname based on our</pre></div>
<div class="cov"><span class="num"><pre>338</pre></span><pre>	typetree &quot;&quot;&quot;</pre></div>
<div class="skip"><span class="num"><pre>339</pre></span><pre></pre></div>
<div class="cov"><span class="num"><pre>340</pre></span><pre>	def __new__( 	dagtree, module, metacls, name, bases, clsdict,</pre></div>
<div class="cov"><span class="num"><pre>341</pre></span><pre>					nameToTreeFunc=uncapitalize, treeToNameFunc=capitalize ):</pre></div>
<div class="cov"><span class="num"><pre>342</pre></span><pre>		&quot;&quot;&quot;Create a new class from hierarchy information found in dagtree and</pre></div>
<div class="cov"><span class="num"><pre>343</pre></span><pre>		put it into the module if it not yet exists</pre></div>
<div class="skip"><span class="num"><pre>344</pre></span><pre>		</pre></div>
<div class="cov"><span class="num"><pre>345</pre></span><pre>		:param dagtree: `mrv.util.DAGTree` instance with hierarchy information</pre></div>
<div class="cov"><span class="num"><pre>346</pre></span><pre>		:param module: the module instance to which to add the new classes to</pre></div>
<div class="cov"><span class="num"><pre>347</pre></span><pre>		:param nameToTreeFunc: convert the class name to a name suitable for dagTree look-up</pre></div>
<div class="cov"><span class="num"><pre>348</pre></span><pre>		:param treeToNameFunc: convert a value from the dag tree into a valid class name ( used for parent lookup )&quot;&quot;&quot;</pre></div>
<div class="skip"><span class="num"><pre>349</pre></span><pre>		# recreate the hierarchy of classes leading to the current type</pre></div>
<div class="cov"><span class="num"><pre>350</pre></span><pre>		nameForTree = nameToTreeFunc( name )</pre></div>
<div class="cov"><span class="num"><pre>351</pre></span><pre>		parentname = None</pre></div>
<div class="cov"><span class="num"><pre>352</pre></span><pre>		try:</pre></div>
<div class="cov"><span class="num"><pre>353</pre></span><pre>			parentname = dagtree.parent( nameForTree )</pre></div>
<div class="cov"><span class="num"><pre>354</pre></span><pre>		except networkxexc.NetworkXError:</pre></div>
<div class="skip"><span class="num"><pre>355</pre></span><pre>			# we can handle and thus ignore key errors, mostly created by subclass</pre></div>
<div class="skip"><span class="num"><pre>356</pre></span><pre>			# of our wrapped classes</pre></div>
<div class="cov"><span class="num"><pre>357</pre></span><pre>			pass</pre></div>
<div class="skip"><span class="num"><pre>358</pre></span><pre>		# END parent name handling</pre></div>
<div class="skip"><span class="num"><pre>359</pre></span><pre></pre></div>
<div class="cov"><span class="num"><pre>360</pre></span><pre>		parentcls = None</pre></div>
<div class="skip"><span class="num"><pre>361</pre></span><pre></pre></div>
<div class="skip"><span class="num"><pre>362</pre></span><pre>		# ASSURE PARENTS</pre></div>
<div class="skip"><span class="num"><pre>363</pre></span><pre>		#####################</pre></div>
<div class="skip"><span class="num"><pre>364</pre></span><pre>		# Parent classes must be available in advance</pre></div>
<div class="cov"><span class="num"><pre>365</pre></span><pre>		if parentname is not None:</pre></div>
<div class="cov"><span class="num"><pre>366</pre></span><pre>			parentclsname = treeToNameFunc( parentname )</pre></div>
<div class="cov"><span class="num"><pre>367</pre></span><pre>			parentcls = module.__dict__[ parentclsname ]</pre></div>
<div class="cov"><span class="num"><pre>368</pre></span><pre>			if isinstance( parentcls, StandinClass ):</pre></div>
<div class="cov"><span class="num"><pre>369</pre></span><pre>				parentcls = parentcls.createCls( )</pre></div>
<div class="skip"><span class="num"><pre>370</pre></span><pre>		# END if parent cls name defined</pre></div>
<div class="skip"><span class="num"><pre>371</pre></span><pre></pre></div>
<div class="skip"><span class="num"><pre>372</pre></span><pre>		# could be a user-defined class coming with some parents already - thus assure</pre></div>
<div class="skip"><span class="num"><pre>373</pre></span><pre>		# that the auto-parent is not already in there</pre></div>
<div class="skip"><span class="num"><pre>374</pre></span><pre>		# NOTE: bases is sometimes filled with types, sometimes with classes</pre></div>
<div class="cov"><span class="num"><pre>375</pre></span><pre>		if parentcls and not ( parentcls in bases or isinstance( parentcls, bases ) ):</pre></div>
<div class="cov"><span class="num"><pre>376</pre></span><pre>			bases += ( parentcls, )</pre></div>
<div class="skip"><span class="num"><pre>377</pre></span><pre></pre></div>
<div class="skip"><span class="num"><pre>378</pre></span><pre>		# create the class</pre></div>
<div class="cov"><span class="num"><pre>379</pre></span><pre>		newcls = super( MetaClassCreator, metacls ).__new__( metacls, str( name ), bases, clsdict )</pre></div>
<div class="skip"><span class="num"><pre>380</pre></span><pre></pre></div>
<div class="skip"><span class="num"><pre>381</pre></span><pre>		# change the module - otherwise it will get our module</pre></div>
<div class="cov"><span class="num"><pre>382</pre></span><pre>		newcls.__module__ = module.__name__</pre></div>
<div class="skip"><span class="num"><pre>383</pre></span><pre></pre></div>
<div class="skip"><span class="num"><pre>384</pre></span><pre>		# replace the dummy class in the module</pre></div>
<div class="cov"><span class="num"><pre>385</pre></span><pre>		module.__dict__[ name ] = newcls</pre></div>
<div class="skip"><span class="num"><pre>386</pre></span><pre></pre></div>
<div class="skip"><span class="num"><pre>387</pre></span><pre></pre></div>
<div class="skip"><span class="num"><pre>388</pre></span><pre></pre></div>
<div class="cov"><span class="num"><pre>389</pre></span><pre>		return newcls</pre></div>
<div class="skip"><span class="num"><pre>390</pre></span><pre></pre></div>
<div class="cov"><span class="num"><pre>391</pre></span><pre>class CallbackEventBase( util.Event ):</pre></div>
<div class="cov"><span class="num"><pre>392</pre></span><pre>	&quot;&quot;&quot;Allows the mapping of MMessage callbacks to mrv's event sender system.</pre></div>
<div class="cov"><span class="num"><pre>393</pre></span><pre>	This event will register a new message once the first event receiver registers</pre></div>
<div class="cov"><span class="num"><pre>394</pre></span><pre>	itself. Once the last event receiver deregisters, the message will be deregistered in </pre></div>
<div class="cov"><span class="num"><pre>395</pre></span><pre>	maya as well.</pre></div>
<div class="skip"><span class="num"><pre>396</pre></span><pre>	</pre></div>
<div class="cov"><span class="num"><pre>397</pre></span><pre>	Derived types have to implement the `_getRegisterFunction`</pre></div>
<div class="skip"><span class="num"><pre>398</pre></span><pre>	</pre></div>
<div class="cov"><span class="num"><pre>399</pre></span><pre>	:note: Its important that you care about deregistering your event to make sure the maya event can </pre></div>
<div class="cov"><span class="num"><pre>400</pre></span><pre>		be deregistered. Its worth knowing that the eventSender in question is strongly </pre></div>
<div class="cov"><span class="num"><pre>401</pre></span><pre>		bound to his callback event, so it cannot be deleted while the event is active.&quot;&quot;&quot;</pre></div>
<div class="skip"><span class="num"><pre>402</pre></span><pre></pre></div>
<div class="skip"><span class="num"><pre>403</pre></span><pre>	#{ Utility Classes</pre></div>
<div class="cov"><span class="num"><pre>404</pre></span><pre>	class CBStorageFunction(object):</pre></div>
<div class="cov"><span class="num"><pre>405</pre></span><pre>		__slots__ = '_callbackID'</pre></div>
<div class="cov"><span class="num"><pre>406</pre></span><pre>		def __init__(self, callbackID=None):</pre></div>
<div class="cov"><span class="num"><pre>407</pre></span><pre>			self.setCallbackID(callbackID)</pre></div>
<div class="skip"><span class="num"><pre>408</pre></span><pre>		</pre></div>
<div class="cov"><span class="num"><pre>409</pre></span><pre>		def setCallbackID(self, callbackID):</pre></div>
<div class="cov"><span class="num"><pre>410</pre></span><pre>			self._callbackID = callbackID</pre></div>
<div class="skip"><span class="num"><pre>411</pre></span><pre>		</pre></div>
<div class="cov"><span class="num"><pre>412</pre></span><pre>		def callbackID(self):</pre></div>
<div class="cov"><span class="num"><pre>413</pre></span><pre>			return self._callbackID</pre></div>
<div class="skip"><span class="num"><pre>414</pre></span><pre>		</pre></div>
<div class="cov"><span class="num"><pre>415</pre></span><pre>		def removeCallback(self):</pre></div>
<div class="cov"><span class="num"><pre>416</pre></span><pre>			if self._callbackID:</pre></div>
<div class="cov"><span class="num"><pre>417</pre></span><pre>				api.MMessage.removeCallback(self._callbackID)</pre></div>
<div class="skip"><span class="num"><pre>418</pre></span><pre>				# prevent memory leak message if possible</pre></div>
<div class="cov"><span class="num"><pre>419</pre></span><pre>				if hasattr(self._callbackID, 'disown'):</pre></div>
<div class="nocov"><span class="num"><pre>420</pre></span><pre>					self._callbackID.disown()</pre></div>
<div class="cov"><span class="num"><pre>421</pre></span><pre>				self._callbackID = None</pre></div>
<div class="skip"><span class="num"><pre>422</pre></span><pre>			# END </pre></div>
<div class="skip"><span class="num"><pre>423</pre></span><pre>		</pre></div>
<div class="cov"><span class="num"><pre>424</pre></span><pre>		def __call__(self, *args, **kwargs):</pre></div>
<div class="cov"><span class="num"><pre>425</pre></span><pre>			return self._callbackID</pre></div>
<div class="skip"><span class="num"><pre>426</pre></span><pre>	#} END utility classes</pre></div>
<div class="skip"><span class="num"><pre>427</pre></span><pre></pre></div>
<div class="cov"><span class="num"><pre>428</pre></span><pre>	def __init__( self, eventId, **kwargs ):</pre></div>
<div class="cov"><span class="num"><pre>429</pre></span><pre>		&quot;&quot;&quot;Initialize our instance with the callbackID we are to represent.&quot;&quot;&quot;</pre></div>
<div class="cov"><span class="num"><pre>430</pre></span><pre>		super( CallbackEventBase, self ).__init__( **kwargs )</pre></div>
<div class="cov"><span class="num"><pre>431</pre></span><pre>		self._eventID = eventId</pre></div>
<div class="skip"><span class="num"><pre>432</pre></span><pre>		</pre></div>
<div class="skip"><span class="num"><pre>433</pre></span><pre>	#{ Subclass Implementation Needed</pre></div>
<div class="cov"><span class="num"><pre>434</pre></span><pre>	def _getRegisterFunction(self, eventID):</pre></div>
<div class="cov"><span class="num"><pre>435</pre></span><pre>		&quot;&quot;&quot;</pre></div>
<div class="cov"><span class="num"><pre>436</pre></span><pre>		:return: MMessage::register* compatible callback function which can be </pre></div>
<div class="cov"><span class="num"><pre>437</pre></span><pre>			used to register the given eventID&quot;&quot;&quot;</pre></div>
<div class="nocov"><span class="num"><pre>438</pre></span><pre>		raise NotImplementedError(&quot;To be implemented in subclass&quot;)</pre></div>
<div class="skip"><span class="num"><pre>439</pre></span><pre></pre></div>
<div class="skip"><span class="num"><pre>440</pre></span><pre>	#} END subclass implementation needed</pre></div>
<div class="skip"><span class="num"><pre>441</pre></span><pre></pre></div>
<div class="skip"><span class="num"><pre>442</pre></span><pre>	#{ CallbackID handling</pre></div>
<div class="cov"><span class="num"><pre>443</pre></span><pre>	def _storeCallbackID(self, inst, callbackID):</pre></div>
<div class="cov"><span class="num"><pre>444</pre></span><pre>		&quot;&quot;&quot;Store the given callbackID in the event sender instance. </pre></div>
<div class="cov"><span class="num"><pre>445</pre></span><pre>		We do that by registering it as function for the given instance which</pre></div>
<div class="skip"><span class="num"><pre>446</pre></span><pre>		</pre></div>
<div class="cov"><span class="num"><pre>447</pre></span><pre>		:return: the callback ID on call&quot;&quot;&quot;</pre></div>
<div class="cov"><span class="num"><pre>448</pre></span><pre>		storage = self._getCallbackIDStorage(inst, create=True)</pre></div>
<div class="cov"><span class="num"><pre>449</pre></span><pre>		storage.setCallbackID(callbackID)</pre></div>
<div class="skip"><span class="num"><pre>450</pre></span><pre>		</pre></div>
<div class="cov"><span class="num"><pre>451</pre></span><pre>	def _getCallbackIDStorage(self, inst, create=False):</pre></div>
<div class="cov"><span class="num"><pre>452</pre></span><pre>		&quot;&quot;&quot;</pre></div>
<div class="cov"><span class="num"><pre>453</pre></span><pre>		:return: Callback storage function if it exists or None</pre></div>
<div class="cov"><span class="num"><pre>454</pre></span><pre>		:param create: if True, the storage will be created if needed, hence </pre></div>
<div class="cov"><span class="num"><pre>455</pre></span><pre>			you will always receive a valid storage&quot;&quot;&quot;</pre></div>
<div class="cov"><span class="num"><pre>456</pre></span><pre>		functions = self._getFunctionSet(inst)</pre></div>
<div class="cov"><span class="num"><pre>457</pre></span><pre>		storage_functions = [ cb for cb in functions if isinstance(cb, self.CBStorageFunction) ]</pre></div>
<div class="cov"><span class="num"><pre>458</pre></span><pre>		if not storage_functions:</pre></div>
<div class="cov"><span class="num"><pre>459</pre></span><pre>			if not create:</pre></div>
<div class="cov"><span class="num"><pre>460</pre></span><pre>				return None</pre></div>
<div class="skip"><span class="num"><pre>461</pre></span><pre>			</pre></div>
<div class="cov"><span class="num"><pre>462</pre></span><pre>			sf = self.CBStorageFunction()</pre></div>
<div class="cov"><span class="num"><pre>463</pre></span><pre>			functions.add(sf)</pre></div>
<div class="cov"><span class="num"><pre>464</pre></span><pre>			return sf</pre></div>
<div class="skip"><span class="num"><pre>465</pre></span><pre>		# END handle storage does not exists</pre></div>
<div class="skip"><span class="num"><pre>466</pre></span><pre>		</pre></div>
<div class="cov"><span class="num"><pre>467</pre></span><pre>		assert len(storage_functions) == 1, &quot;Expecting only one storage function, found %i&quot; % len(storage_functions)</pre></div>
<div class="cov"><span class="num"><pre>468</pre></span><pre>		return storage_functions[0]</pre></div>
<div class="skip"><span class="num"><pre>469</pre></span><pre>		</pre></div>
<div class="cov"><span class="num"><pre>470</pre></span><pre>	def _getCallbackID(self, inst):</pre></div>
<div class="cov"><span class="num"><pre>471</pre></span><pre>		&quot;&quot;&quot;:return: stored callback ID or None&quot;&quot;&quot;</pre></div>
<div class="cov"><span class="num"><pre>472</pre></span><pre>		storage = self._getCallbackIDStorage(inst)</pre></div>
<div class="cov"><span class="num"><pre>473</pre></span><pre>		if storage is None:</pre></div>
<div class="cov"><span class="num"><pre>474</pre></span><pre>			return None</pre></div>
<div class="cov"><span class="num"><pre>475</pre></span><pre>		return storage.callbackID()</pre></div>
<div class="skip"><span class="num"><pre>476</pre></span><pre>		</pre></div>
<div class="skip"><span class="num"><pre>477</pre></span><pre>	#} END handle callback ID</pre></div>
<div class="skip"><span class="num"><pre>478</pre></span><pre></pre></div>
<div class="skip"><span class="num"><pre>479</pre></span><pre>	</pre></div>
<div class="cov"><span class="num"><pre>480</pre></span><pre>	def send( self, inst, *args, **kwargs ):</pre></div>
<div class="cov"><span class="num"><pre>481</pre></span><pre>		&quot;&quot;&quot;Sets our instance prior to calling the super class</pre></div>
<div class="skip"><span class="num"><pre>482</pre></span><pre>		</pre></div>
<div class="cov"><span class="num"><pre>483</pre></span><pre>		:note: must not be called manually&quot;&quot;&quot;</pre></div>
<div class="skip"><span class="num"><pre>484</pre></span><pre>		# fake the instance</pre></div>
<div class="cov"><span class="num"><pre>485</pre></span><pre>		self._last_inst_ref = weakref.ref(inst)</pre></div>
<div class="cov"><span class="num"><pre>486</pre></span><pre>		super(CallbackEventBase, self).send(*args, **kwargs)</pre></div>
<div class="skip"><span class="num"><pre>487</pre></span><pre></pre></div>
<div class="cov"><span class="num"><pre>488</pre></span><pre>	def __set__(  self, inst, eventfunc ):</pre></div>
<div class="cov"><span class="num"><pre>489</pre></span><pre>		eventset = self._getFunctionSet( inst )</pre></div>
<div class="skip"><span class="num"><pre>490</pre></span><pre></pre></div>
<div class="skip"><span class="num"><pre>491</pre></span><pre>		# REGISTER MCALLBACK IF THIS IS THE FIRST EVENTRECEIVER</pre></div>
<div class="cov"><span class="num"><pre>492</pre></span><pre>		if not eventset:</pre></div>
<div class="cov"><span class="num"><pre>493</pre></span><pre>			reg_method = self._getRegisterFunction(self._eventID)</pre></div>
<div class="skip"><span class="num"><pre>494</pre></span><pre>			</pre></div>
<div class="cov"><span class="num"><pre>495</pre></span><pre>			dyncall = lambda *args, **kwargs: self.send(inst, *args, **kwargs)</pre></div>
<div class="cov"><span class="num"><pre>496</pre></span><pre>			callbackID = reg_method(self._eventID, dyncall)</pre></div>
<div class="cov"><span class="num"><pre>497</pre></span><pre>			self._storeCallbackID(inst, callbackID)</pre></div>
<div class="skip"><span class="num"><pre>498</pre></span><pre>		# END create event</pre></div>
<div class="skip"><span class="num"><pre>499</pre></span><pre></pre></div>
<div class="cov"><span class="num"><pre>500</pre></span><pre>		super( CallbackEventBase, self ).__set__( inst, eventfunc )</pre></div>
<div class="skip"><span class="num"><pre>501</pre></span><pre>		</pre></div>
<div class="cov"><span class="num"><pre>502</pre></span><pre>	def remove(self, eventfunc):</pre></div>
<div class="cov"><span class="num"><pre>503</pre></span><pre>		&quot;&quot;&quot;Also removes our callback if the last receiver is gone&quot;&quot;&quot;</pre></div>
<div class="cov"><span class="num"><pre>504</pre></span><pre>		super(CallbackEventBase, self).remove(eventfunc)</pre></div>
<div class="cov"><span class="num"><pre>505</pre></span><pre>		inst = self._get_last_instance()</pre></div>
<div class="cov"><span class="num"><pre>506</pre></span><pre>		functions = self._getFunctionSet( inst )</pre></div>
<div class="skip"><span class="num"><pre>507</pre></span><pre>		</pre></div>
<div class="skip"><span class="num"><pre>508</pre></span><pre>		# if there is only one item left, this should be our storage function</pre></div>
<div class="cov"><span class="num"><pre>509</pre></span><pre>		if len(functions) == 1:</pre></div>
<div class="cov"><span class="num"><pre>510</pre></span><pre>			cbstorage = iter(functions).next()</pre></div>
<div class="cov"><span class="num"><pre>511</pre></span><pre>			assert isinstance(cbstorage, self.CBStorageFunction)</pre></div>
<div class="skip"><span class="num"><pre>512</pre></span><pre>			</pre></div>
<div class="cov"><span class="num"><pre>513</pre></span><pre>			cbstorage.removeCallback()</pre></div>
<div class="cov"><span class="num"><pre>514</pre></span><pre>			functions.remove(cbstorage)</pre></div>
<div class="skip"><span class="num"><pre>515</pre></span><pre>		# END dergister event</pre></div>
<div class="skip"><span class="num"><pre>516</pre></span><pre>		</pre></div>
<div class="skip"><span class="num"><pre>517</pre></span><pre>		</pre></div>
<div class="cov"><span class="num"><pre>518</pre></span><pre>class MEnumeration(tuple):</pre></div>
<div class="cov"><span class="num"><pre>519</pre></span><pre>	&quot;&quot;&quot;Simple enumeration class which allows access to its enumeration using </pre></div>
<div class="cov"><span class="num"><pre>520</pre></span><pre>	getattr access. </pre></div>
<div class="cov"><span class="num"><pre>521</pre></span><pre>	As it is a tuple as well, one can access the enumeration values in the right sequencial</pre></div>
<div class="cov"><span class="num"><pre>522</pre></span><pre>	order&quot;&quot;&quot;</pre></div>
<div class="cov"><span class="num"><pre>523</pre></span><pre>	def __new__(cls, sequence, name=''):</pre></div>
<div class="cov"><span class="num"><pre>524</pre></span><pre>		inst = super(MEnumeration, cls).__new__(cls, sequence)</pre></div>
<div class="cov"><span class="num"><pre>525</pre></span><pre>		inst.name = name</pre></div>
<div class="cov"><span class="num"><pre>526</pre></span><pre>		return inst</pre></div>
<div class="skip"><span class="num"><pre>527</pre></span><pre>		</pre></div>
<div class="cov"><span class="num"><pre>528</pre></span><pre>	def __str__(self):</pre></div>
<div class="nocov"><span class="num"><pre>529</pre></span><pre>		return self.name</pre></div>
<div class="skip"><span class="num"><pre>530</pre></span><pre>	</pre></div>
<div class="cov"><span class="num"><pre>531</pre></span><pre>	def __repr__(self):</pre></div>
<div class="nocov"><span class="num"><pre>532</pre></span><pre>		return &quot;MEnumeration(%s)&quot; % self.name</pre></div>
<div class="skip"><span class="num"><pre>533</pre></span><pre>	</pre></div>
<div class="skip"><span class="num"><pre>534</pre></span><pre>	#{ Interface</pre></div>
<div class="skip"><span class="num"><pre>535</pre></span><pre>	</pre></div>
<div class="cov"><span class="num"><pre>536</pre></span><pre>	def nameByValue(self, value):</pre></div>
<div class="cov"><span class="num"><pre>537</pre></span><pre>		&quot;&quot;&quot;:return: name string with the given integer value</pre></div>
<div class="cov"><span class="num"><pre>538</pre></span><pre>		:param value: integer value of this enumeration</pre></div>
<div class="cov"><span class="num"><pre>539</pre></span><pre>		:raise ValueError: if value is not in the enumeration&quot;&quot;&quot;</pre></div>
<div class="cov"><span class="num"><pre>540</pre></span><pre>		for n,v in self.__dict__.items():</pre></div>
<div class="cov"><span class="num"><pre>541</pre></span><pre>			if not n.startswith('k') or not isinstance(v, int):</pre></div>
<div class="cov"><span class="num"><pre>542</pre></span><pre>				continue</pre></div>
<div class="skip"><span class="num"><pre>543</pre></span><pre>				</pre></div>
<div class="cov"><span class="num"><pre>544</pre></span><pre>			if v == value:</pre></div>
<div class="cov"><span class="num"><pre>545</pre></span><pre>				return n</pre></div>
<div class="skip"><span class="num"><pre>546</pre></span><pre>			# END if value matches</pre></div>
<div class="skip"><span class="num"><pre>547</pre></span><pre>		# END for each item in our dict</pre></div>
<div class="cov"><span class="num"><pre>548</pre></span><pre>		raise ValueError(&quot;Value %i not in enumeration&quot; % value)</pre></div>
<div class="skip"><span class="num"><pre>549</pre></span><pre>		</pre></div>
<div class="skip"><span class="num"><pre>550</pre></span><pre>	#} END interface</pre></div>
<div class="skip"><span class="num"><pre>551</pre></span><pre>	</pre></div>
<div class="cov"><span class="num"><pre>552</pre></span><pre>	@classmethod</pre></div>
<div class="cov"><span class="num"><pre>553</pre></span><pre>	def create( cls, ed, mfncls ):</pre></div>
<div class="cov"><span class="num"><pre>554</pre></span><pre>		&quot;&quot;&quot;</pre></div>
<div class="cov"><span class="num"><pre>555</pre></span><pre>		:return: new instance of this type as initialized from the EnumDescriptor ed and </pre></div>
<div class="cov"><span class="num"><pre>556</pre></span><pre>			the mfncls</pre></div>
<div class="cov"><span class="num"><pre>557</pre></span><pre>		&quot;&quot;&quot;</pre></div>
<div class="cov"><span class="num"><pre>558</pre></span><pre>		emembers = list()		# temporary</pre></div>
<div class="skip"><span class="num"><pre>559</pre></span><pre>		</pre></div>
<div class="skip"><span class="num"><pre>560</pre></span><pre>		# get the values in the right sequence</pre></div>
<div class="cov"><span class="num"><pre>561</pre></span><pre>		try:</pre></div>
<div class="cov"><span class="num"><pre>562</pre></span><pre>			for em in ed:</pre></div>
<div class="cov"><span class="num"><pre>563</pre></span><pre>				ev = getattr(mfncls, em)</pre></div>
<div class="cov"><span class="num"><pre>564</pre></span><pre>				emembers.append(ev)</pre></div>
<div class="skip"><span class="num"><pre>565</pre></span><pre>			# END for each enumeration member</pre></div>
<div class="nocov"><span class="num"><pre>566</pre></span><pre>		except AttributeError:</pre></div>
<div class="skip"><span class="num"><pre>567</pre></span><pre>			# happens in 2008+ as they have ifdeffed items that we pick up, </pre></div>
<div class="skip"><span class="num"><pre>568</pre></span><pre>			# but which are somewhat inoffical</pre></div>
<div class="nocov"><span class="num"><pre>569</pre></span><pre>			pass</pre></div>
<div class="skip"><span class="num"><pre>570</pre></span><pre>		# END exception handling</pre></div>
<div class="skip"><span class="num"><pre>571</pre></span><pre>		</pre></div>
<div class="cov"><span class="num"><pre>572</pre></span><pre>		enum = cls(emembers, name=ed.name)</pre></div>
<div class="skip"><span class="num"><pre>573</pre></span><pre>		</pre></div>
<div class="skip"><span class="num"><pre>574</pre></span><pre>		# assign each member by name</pre></div>
<div class="cov"><span class="num"><pre>575</pre></span><pre>		try:</pre></div>
<div class="cov"><span class="num"><pre>576</pre></span><pre>			for em in ed:</pre></div>
<div class="cov"><span class="num"><pre>577</pre></span><pre>				ev = getattr(mfncls, em)</pre></div>
<div class="cov"><span class="num"><pre>578</pre></span><pre>				setattr(enum, em, ev)</pre></div>
<div class="skip"><span class="num"><pre>579</pre></span><pre>			# END for each enumeration member</pre></div>
<div class="nocov"><span class="num"><pre>580</pre></span><pre>		except AttributeError:</pre></div>
<div class="nocov"><span class="num"><pre>581</pre></span><pre>			pass</pre></div>
<div class="skip"><span class="num"><pre>582</pre></span><pre>		# END exception handlign</pre></div>
<div class="skip"><span class="num"><pre>583</pre></span><pre>		</pre></div>
<div class="cov"><span class="num"><pre>584</pre></span><pre>		return enum</pre></div>
<div class="skip"><span class="num"><pre>585</pre></span><pre>	</pre></div>
<div class="skip"><span class="num"><pre>586</pre></span><pre>#} END api utility classes</pre></div>
<div class="skip"><span class="num"><pre>587</pre></span><pre></pre></div>
</div>
</body>
</html>
