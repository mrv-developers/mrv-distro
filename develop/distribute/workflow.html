<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Distribution Workflow &mdash; mrv v1.0.2-develop documentation</title>
    <link rel="stylesheet" href="../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '1.0.2-develop',
        COLLAPSE_MODINDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="author" title="About these documents" href="../../about.html" />
    <link rel="top" title="mrv v1.0.2-develop documentation" href="../../index.html" />
    <link rel="up" title="Distribution" href="index.html" />
    <link rel="next" title="The Template Project" href="../projects.html" />
    <link rel="prev" title="The Documentation Generator" href="docs.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../modindex.html" title="Global Module Index"
             accesskey="M">modules</a> |</li>
        <li class="right" >
          <a href="../projects.html" title="The Template Project"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="docs.html" title="The Documentation Generator"
             accesskey="P">previous</a> |</li>
        <li><a href="../../index.html">mrv v1.0.2-develop documentation</a> &raquo;</li>
          <li><a href="../index.html" >Development</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">Distribution</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="distribution-workflow">
<span id="dist-workflow-label"></span><h1>Distribution Workflow<a class="headerlink" href="#distribution-workflow" title="Permalink to this headline">¶</a></h1>
<p>Preparing a distribution at some point is as easy as running <tt class="docutils literal"><span class="pre">make</span> <span class="pre">release</span></tt> ( on windows it would be something like <tt class="docutils literal"><span class="pre">make-release.bat</span></tt> ). Until that point is reached though, one will have to go through an iterative setup and testing procedure which will be described here.</p>
<p>The workflow guide assumes that you have a default setup of your <a class="reference external" href="pinfo.html"><em>info module</em></a> and <a class="reference external" href="setup.html"><em>setup.py script</em></a>, and if you started from the <a class="reference external" href="../projects.html#template-project-label"><em>template project</em></a> this will already be in working order. Once your project grows and you decide to distribute only parts of it, the somewhat advanced techniques described here later on will help getting good results faster.</p>
<p>In the following sections it will also be assumed that you made yourself familiar with the <a class="reference external" href="setup.html#setup-label"><em>setup.py script</em></a> and its general use.</p>
<div class="section" id="distribution-tracking">
<h2>Distribution Tracking<a class="headerlink" href="#distribution-tracking" title="Permalink to this headline">¶</a></h2>
<p>No matter what kind of distribution you are going to create, it is wise to setup good means of tracking them. The MRV distribution system supports this by integrating git, using tags, branches, and commit messages to track where each distribution came from and from which source tree it was created.</p>
<p>This is vital in case patches need to be back-ported to existing releases, to mention just one example.</p>
<p>To enable git when creating a distribution, set the <tt class="docutils literal"><span class="pre">--use-git</span></tt> flag to 1 on the setup script.</p>
<p>Details about the git-handling can be found <a class="reference external" href="setup.html#setup-git-label"><em>in the setup script&#8217;s documentation</em></a>.</p>
</div>
<div class="section" id="quality-assurance">
<h2>Quality Assurance<a class="headerlink" href="#quality-assurance" title="Permalink to this headline">¶</a></h2>
<p>One thing you want to do <em>before</em> most releases is to run the unit-tests in the most possible variations and on all supported platforms. In practice this won&#8217;t always be possible, but MRV facilitates this through the integration of regression testing provided by the <a class="reference external" href="../../tools.html#tmrvr-label"><em>tmrv tool</em></a>.</p>
<p>It will run all tests on all installed maya versions and report failure if one test fails.</p>
<p>Depending on your distribution target, you would set the <tt class="docutils literal"><span class="pre">--regression-tests</span></tt> flag to <em>1</em>.</p>
</div>
<div class="section" id="distribution-targets">
<h2>Distribution Targets<a class="headerlink" href="#distribution-targets" title="Permalink to this headline">¶</a></h2>
<p>The final decision would be to determine which kind of distributions you need.</p>
<p>Currently there is native support for source and binary distributions, possibly distinguishing between <em>beta</em> or <em>final release</em> distributions. The first ones mentioned are less strict with their version and git tags, by allowing the program version to remain the same, by simply moving the same tag around. This can be accomplished by the <tt class="docutils literal"><span class="pre">--force-git-tag</span></tt> distribution flag.</p>
<p>The documentation usually needs to be build from an intermediate markup language, which is accomplished by <a class="reference external" href="docs.html"><em>makedoc</em></a>, hence it an own distribution target.</p>
<p>Each distribution target usually ends up in one compressed archive and possibly in a dedicated git branch to connect it to previous versions of the respective distribution target.</p>
<p>All of these targets can be combined freely according to your needs.</p>
</div>
<div class="section" id="the-source-distribution">
<h2>The Source Distribution<a class="headerlink" href="#the-source-distribution" title="Permalink to this headline">¶</a></h2>
<p>This kind of distribution is the most complex as it <a class="reference external" href="setup.html#setup-intimacies-label"><em>turns out</em></a>, and starts by creating a MANIFEST.in file.</p>
<p>With it you define the exact set of files to distribute.</p>
<p>Once you are sure about the set of files to include in your source distribution, adjust your <a class="reference external" href="setup.html#setup-manifestin-label"><em>Manifest Template</em></a> accordingly.</p>
<p>The following command will prepare a source distribution and create a zip archive from it:</p>
<div class="highlight-python"><pre>$ python setup.py sdist --format=zip</pre>
</div>
<p>You will find the zip archive in the <tt class="docutils literal"><span class="pre">dist</span></tt> folder. But is this source distribution complete ? Are all files included that the project needs to run ?</p>
<p>To verify that it is operational, it is required to re-run the unit-tests, using the given maya version:</p>
<div class="highlight-python"><pre>$ python setup.py sdist --format=zip --post-testing=2011</pre>
</div>
<p>If that works as well, you have a good indication that you are ready to proceed to the next step, <a class="reference internal" href="#the-binary-distribution">The Binary Distribution</a>, which is required if you would like the user to be able to automatically install your project into his python installation. It is somewhat unfortunate that you can&#8217;t just go with the working source package.</p>
<p>Please note that the commandline presented here represented the bare minimum, one which might be more suitable for final releases would look more like this:</p>
<div class="highlight-python"><pre>$ python setup.py --use-git=1 --regression-tests=1 sdist --format=zip --post-testing=8.5,2011 --root-remotes=origin --dist-remotes=distro,hubdistro</pre>
</div>
<p>The preceding command tells the distribution system to run all regression tests, setup a git tag in your root repository with the proper version number, create a source distribution, run all unit tests in that distribution for maya 8.5 and 2011, to finally push the tagged changes in the root repository ( containing your sources ) to the remote named <em>origin</em>, and the tagged distribution data itself to the remotes named <em>distro</em> and <em>hubdistro</em>.</p>
</div>
<div class="section" id="the-binary-distribution">
<h2>The Binary Distribution<a class="headerlink" href="#the-binary-distribution" title="Permalink to this headline">¶</a></h2>
<p>This step is required if you want to make your distribution installable, or if you don&#8217;t want to distribute the sources of your project. In the latter case please keep in mind that you will have to byte-compile for each minor version of the python interpreter, each interpreter represents a separate distribution target.</p>
<p>If you are coming from <a class="reference internal" href="#the-source-distribution">The Source Distribution</a>, you were used to simple and straightforward definition of the files and folders to distribute. This nice time might be over now, depending on the complexity of your project of course.</p>
<p>The cause of this is mainly the lack of something like the MANIFEST template, hence the files to <tt class="docutils literal"><span class="pre">build</span></tt> need to be specified using keyword arguments given to the <tt class="docutils literal"><span class="pre">setup()</span></tt> routine of your <em>setup.py</em> script.</p>
<p>This information is bundled in the <tt class="docutils literal"><span class="pre">setup_kwargs</span></tt> member variable in your <a class="reference external" href="pinfo.html"><em>info module</em></a>. Here it is best to have a look at <em>MRV</em>s well documented version of this file.</p>
<p>Generally, you have to watch out for the following:</p>
<ul class="simple">
<li>If you have scripts that should end up as executables on the target system, specify them in the <tt class="docutils literal"><span class="pre">scripts</span></tt> keyword.</li>
<li>If you have modules that require additional data, specify the data files using the <tt class="docutils literal"><span class="pre">package_data</span></tt> keyword.</li>
<li>If you have additional (external) packages outside of the default <tt class="docutils literal"><span class="pre">ext</span></tt> directory, provide the <tt class="docutils literal"><span class="pre">package_search_dirs</span></tt> keyword which expects a list of relative directories.</li>
<li>Specific setup subcommands are fed directly with the <tt class="docutils literal"><span class="pre">options</span></tt> keyword</li>
</ul>
<blockquote>
<ul class="simple">
<li>To exclude specific modules from byte-compilation, list patterns in the <tt class="docutils literal"><span class="pre">exclude_from_compile</span></tt> keyword of the <tt class="docutils literal"><span class="pre">build_py</span></tt> command.</li>
<li>To exclude packages, modules and data files from being included in the build, list the modules in the <tt class="docutils literal"><span class="pre">exclude_items</span></tt> keyword of the <tt class="docutils literal"><span class="pre">build_py</span></tt> command.</li>
<li>To prevent scripts you previously supplied in the <tt class="docutils literal"><span class="pre">scripts</span></tt> keyword from being installed, mention their paths in the <tt class="docutils literal"><span class="pre">exclude_scripts</span></tt> keyword of the <tt class="docutils literal"><span class="pre">build_scripts</span></tt> command.</li>
</ul>
</blockquote>
<ul class="simple">
<li>... and if none of the mentioned issues apply to your project, you can as well continue without a change.</li>
</ul>
<p>Now you would execute a simple build and go back and forth between your <tt class="docutils literal"><span class="pre">info</span> <span class="pre">module</span></tt> configuration and the execution of this line until the unit-tests succeed and the distribution as contained in the <tt class="docutils literal"><span class="pre">build</span></tt> directory passes your visual examination:</p>
<div class="highlight-python"><pre>$ python setup.py --maya-version=2011 build build_py--compile</pre>
</div>
<p>The specified <tt class="docutils literal"><span class="pre">--maya-version</span></tt> indicates the target platform and is required whenever you want to compile your sources, which is optional by the way. Specifying build first makes sure we get a complete build of everything, while telling <tt class="docutils literal"><span class="pre">build_py</span></tt> to compile the sources. Its hard to know which subcommands are executed implicitly without studying the sources of the distutils or without trying to get smart from studying the scattered <a class="reference external" href="http://docs.python.org/distutils">distutils</a> documentation.</p>
<p>Once everything appears to be okay, you are free to produce optimized byte code to have smaller files ( as docstrings will be stripped ), which will automatically exclude the unit test library:</p>
<div class="highlight-python"><pre>$ python setup.py --maya-version=2011 build build_py--optimize=2</pre>
</div>
<p>A fully upgraded binary distribution could look like this:</p>
<div class="highlight-python"><pre>$ python setup.py --use-git=1 --regression-tests=1 build build_py --compile --post-testing=8.5,2011 --root-remotes=origin --dist-remotes=distro,hubdistro bdist bdist_dumb --format=zip</pre>
</div>
<p>The given commandline will create a full build into the <tt class="docutils literal"><span class="pre">build</span></tt> subdirectory, <tt class="docutils literal"><span class="pre">build_py</span></tt> byte-compiles the sources and deletes the source files afterwards. The directory contents will be picked up by <tt class="docutils literal"><span class="pre">bdist</span></tt> to be put into an archive which will extract into the right spot of your platform. <tt class="docutils literal"><span class="pre">bdist</span></tt> allows to specify other target platforms as well, as to be read in the <a class="reference external" href="http://docs.python.org/distutils/builtdist.html">official bdist documentation</a>.</p>
</div>
<div class="section" id="the-documentation-distribution">
<h2>The Documentation Distribution<a class="headerlink" href="#the-documentation-distribution" title="Permalink to this headline">¶</a></h2>
<p>The documentation needs to be built as well, and there is a specialized command which does exactly that by calling <tt class="docutils literal"><span class="pre">./doc/makedoc</span></tt> ( or whatever you have specified in your <tt class="docutils literal"><span class="pre">info</span> <span class="pre">module</span></tt> ).</p>
<p>To be sure the documentation reflects the modules actually used in your source or binary distribution, use the <tt class="docutils literal"><span class="pre">--from-build-version</span></tt> flag. If your distribution does not omit any files, it is usually alright to create ( and possibly reuse ) documentation in your root project which happens if the said flag is not specified.</p>
<p>A basic example would be:</p>
<div class="highlight-python"><pre>$ python setup.py sdist docdist --from-build-version</pre>
</div>
<p>The doc-distribution can also be combined with the source or the binary distribution, just append the <tt class="docutils literal"><span class="pre">docdist</span></tt> part presented here to the commandlines shown in the preceding sections.</p>
</div>
<div class="section" id="verifying-the-installation">
<h2>Verifying the Installation<a class="headerlink" href="#verifying-the-installation" title="Permalink to this headline">¶</a></h2>
<p>If you were following the previous steps, you have two or three zip files ( and a bunch of new commits in your root and distribution repositories ). These zip files correspond to the source-, the binary- and the documentation distribution.</p>
<p>Now one has to verify that these packages actually install correctly. For the sake of brevity, we skip &#8216;dumb&#8217; binary- and documentation installations as these just extract into place, but focus on the source distribution which has to be installed using your very own setup.py script that previously created the distribution package.</p>
<div class="section" id="distutils">
<h3>Distutils<a class="headerlink" href="#distutils" title="Permalink to this headline">¶</a></h3>
<p>To test the source distribution with the <a class="reference external" href="http://docs.python.org/distutils">distutils</a>, we need to extract it into place, change directory into it to execute the following line:</p>
<div class="highlight-python"><pre>$ python setup.py install --prefix=install</pre>
</div>
<p>The purpose of this test is to see whether the script succeeds - if it does the <tt class="docutils literal"><span class="pre">install</span></tt> subdirectory will contain our scripts and modules, by default these have been precompiled to byte-code with the interpreter that ran the setup script. Internally it uses <tt class="docutils literal"><span class="pre">build_py</span></tt> which we already verified to produce a consistent distribution in a prior step, hence it is not strictly required to rerun the unit tests.</p>
</div>
<div class="section" id="setuptools-easy-install">
<h3>Setuptools (easy_install)<a class="headerlink" href="#setuptools-easy-install" title="Permalink to this headline">¶</a></h3>
<p>Another way to install an archive is by using <a class="reference external" href="http://pypi.python.org/pypi/setuptools">easy_install</a>. For the end-user, this is a much more convenient way of installing a package, provided that you have uploaded it to the <a class="reference external" href="http://pypi.python.org/pypi">Python Package Index</a> before, allowing lines like these:</p>
<div class="highlight-python"><pre>$ easy_install your_project</pre>
</div>
<p>Internally, the <tt class="docutils literal"><span class="pre">ez_setup</span></tt> implementation will call <tt class="docutils literal"><span class="pre">setup.py</span> <span class="pre">install</span></tt>. One could assume that it will work if your <tt class="docutils literal"><span class="pre">distutil</span></tt> installation worked, but this is not necessarily true.</p>
<p>Easy_install runs your installation routine within a sandboxed environment that restricts certain operation that try to alter files outside of the installation directory. Unfortunately the implementation does not provide the exact signatures of common <tt class="docutils literal"><span class="pre">os</span></tt> methods, which in turn could cause your script to fail even though you didn&#8217;t try anything &#8216;forbidden&#8217;.</p>
<p>The following commandline tells easy_install not to use pypi, but instead to use your package directly from the <tt class="docutils literal"><span class="pre">dist</span></tt> directory with your distribution archives. Please note that it will install the package in your system, hence you need root permissions and to possibly manually remove the installed egg afterwards.:</p>
<div class="highlight-python"><pre>$ easy_install&lt;-py-version&gt; --allow-hosts None --find-links dist your_project</pre>
</div>
<p>Where &lt;<tt class="docutils literal"><span class="pre">-py-version</span></tt>&gt; is the python version you want to use for the installation. If the installation succeeds, you should be able to use your package and scripts right away in an interactive python session:</p>
<div class="highlight-python"><pre>$ python&lt;py-version&gt;
$ &gt;&gt;&gt; import your_project</pre>
</div>
</div>
<div class="section" id="multi-platform-verification">
<h3>Multi-Platform Verification<a class="headerlink" href="#multi-platform-verification" title="Permalink to this headline">¶</a></h3>
<p>If you are handling paths a lot and manipulate them, or in short, use plenty of operating system facilities, it is vital to make sure your installation works on other platforms as well.</p>
<p>If feasible, run your unit-tests on all supported platforms and try the installation yourself. Usually, the first time you try it on another system, it won&#8217;t work, but is fixable with trivial patches. It good though that you find out about it before the end-user does.</p>
<p>If software doesn&#8217;t work right after the installation, the first impression of &#8220;your project is not working&#8221; is hard to get rid of later.</p>
</div>
</div>
<div class="section" id="automation">
<h2>Automation<a class="headerlink" href="#automation" title="Permalink to this headline">¶</a></h2>
<p>Once the actual commandlines have been figured out and are definitely working, its just about aliasing them to make their execution easy.</p>
<p>On Linux, the simplest way is to write a <em>makefile</em> which contains a few phony targets, this way you can easily choose the distribution targets like:</p>
<div class="highlight-python"><pre>$ make preview
$ make beta-release
$ make final-release
$ make binary-release</pre>
</div>
<p>Writing shell scripts would be possible as well, its up to your personal preference.</p>
<p>On Windows, one might want to resort to writing batch files which serve as an alias, allowing to write something like:</p>
<div class="highlight-python"><pre>$ make-preview.bat
$ make-beta-release.bat
$ make-final-release.bat
$ make-binary-release.bat</pre>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">It is very recommended to maintain targets which are for release-testing only, hence the do not interact with git. This is especially important in the case of the <tt class="docutils literal"><span class="pre">--post-testing</span></tt> flag as it will always do the testing <em>after</em> the changes were pushed to the git repositories, and if the test fails, the changes possibly already reached the public repository. A good insurance against post-testing failures are pre-distribution regression tests, but as these apply to a possibly different file set, post-testing might still fail.</p>
</div>
</div>
<div class="section" id="the-python-package-index">
<h2>The Python Package Index<a class="headerlink" href="#the-python-package-index" title="Permalink to this headline">¶</a></h2>
<p>The <a class="reference external" href="http://pypi.python.org/pypi">Python Package Index</a> helps you to store your release archives in a central place, which makes it available to <tt class="docutils literal"><span class="pre">easy_install</span></tt> automatically. Additionally it provides a spot for your static html documentation, the zip archive <tt class="docutils literal"><span class="pre">docdist</span></tt> creates can be uploaded with just one click.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <h3><a href="../../index.html">Table Of Contents</a></h3>
            <ul>
<li><a class="reference external" href="#">Distribution Workflow</a><ul>
<li><a class="reference external" href="#distribution-tracking">Distribution Tracking</a></li>
<li><a class="reference external" href="#quality-assurance">Quality Assurance</a></li>
<li><a class="reference external" href="#distribution-targets">Distribution Targets</a></li>
<li><a class="reference external" href="#the-source-distribution">The Source Distribution</a></li>
<li><a class="reference external" href="#the-binary-distribution">The Binary Distribution</a></li>
<li><a class="reference external" href="#the-documentation-distribution">The Documentation Distribution</a></li>
<li><a class="reference external" href="#verifying-the-installation">Verifying the Installation</a><ul>
<li><a class="reference external" href="#distutils">Distutils</a></li>
<li><a class="reference external" href="#setuptools-easy-install">Setuptools (easy_install)</a></li>
<li><a class="reference external" href="#multi-platform-verification">Multi-Platform Verification</a></li>
</ul>
</li>
<li><a class="reference external" href="#automation">Automation</a></li>
<li><a class="reference external" href="#the-python-package-index">The Python Package Index</a></li>
</ul>
</li>
</ul>

            <h4>Previous topic</h4>
            <p class="topless"><a href="docs.html"
                                  title="previous chapter">The Documentation Generator</a></p>
            <h4>Next topic</h4>
            <p class="topless"><a href="../projects.html"
                                  title="next chapter">The Template Project</a></p>
            <h3>This Page</h3>
            <ul class="this-page-menu">
              <li><a href="../../_sources/develop/distribute/workflow.txt"
                     rel="nofollow">Show Source</a></li>
            </ul>
          <div id="searchbox" style="display: none">
            <h3>Quick search</h3>
              <form class="search" action="../../search.html" method="get">
                <input type="text" name="q" size="18" />
                <input type="submit" value="Go" />
                <input type="hidden" name="check_keywords" value="yes" />
                <input type="hidden" name="area" value="default" />
              </form>
              <p class="searchtip" style="font-size: 90%">
              Enter search terms or a module, class or function name.
              </p>
          </div>
          <script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../modindex.html" title="Global Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="../projects.html" title="The Template Project"
             >next</a> |</li>
        <li class="right" >
          <a href="docs.html" title="The Documentation Generator"
             >previous</a> |</li>
        <li><a href="../../index.html">mrv v1.0.2-develop documentation</a> &raquo;</li>
          <li><a href="../index.html" >Development</a> &raquo;</li>
          <li><a href="index.html" >Distribution</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
      &copy; Copyright Sebastian Thiel.
      Last updated on Apr 19, 2011.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 0.6.5.
    </div>
  </body>
</html>