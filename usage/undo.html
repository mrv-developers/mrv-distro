<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Undo &mdash; mrv v1.0.1-develop documentation</title>
    <link rel="stylesheet" href="../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1.0.1-develop',
        COLLAPSE_MODINDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="author" title="About these documents" href="../about.html" />
    <link rel="top" title="mrv v1.0.1-develop documentation" href="../index.html" />
    <link rel="up" title="Usage" href="index.html" />
    <link rel="next" title="Persistence" href="persistence.html" />
    <link rel="prev" title="Scene Handling" href="scenes.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../modindex.html" title="Global Module Index"
             accesskey="M">modules</a> |</li>
        <li class="right" >
          <a href="persistence.html" title="Persistence"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="scenes.html" title="Scene Handling"
             accesskey="P">previous</a> |</li>
        <li><a href="../index.html">mrv v1.0.1-develop documentation</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">Usage</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="undo">
<h1>Undo<a class="headerlink" href="#undo" title="Permalink to this headline">¶</a></h1>
<p>The MayaAPI, the very basis of MRV, has limited support for undo as it clearly focuses on performance. Changes to the dependency graph can only be made through a utility which supports undo, but changes to values through plugs for instance  are not covered by that. To allow MRV to be used within user scripts, full undo was implemented wherever needed. This is indicated by the <tt class="docutils literal"><span class="pre">undoable</span></tt> decorator. Whenever a method which changes the state cannot be undone for whichever reason, it is decorated with <tt class="docutils literal"><span class="pre">notundoable</span></tt>.</p>
<p>As you are unlikely going to need undo support when running in batch mode or standalone, you can disable the undo system by setting MRV_UNDO_ENABLED to 0, which causes the undo implementation to completely disappear in many cases, reducing the overhead considerably as well as the memory usage.</p>
<p>In case your method or function uses an undoable method, it must be decorated with <tt class="docutils literal"><span class="pre">undoable</span></tt> as well. If you fail doing so, undo will pick up your individual undoable calls, and a single invocation of maya&#8217;s undo will just undo one of them ( instead of all the changes your method introduced ).</p>
<p>To implement a simple undoable function yourself, you create a functor of type <tt class="docutils literal"><span class="pre">GenericOperation</span></tt> which will be told what to do to apply your operation, and to undo it.</p>
<p>The following example shows how multiple undoable operations are bundled into a single undoable operation:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">maya.cmds</span> <span class="kn">as</span> <span class="nn">cmds</span>
<span class="nd">@undoable</span>
<span class="k">def</span> <span class="nf">undoable_func</span><span class="p">(</span> <span class="n">delobj</span> <span class="p">):</span>
        <span class="n">p</span><span class="o">.</span><span class="n">tx</span><span class="o">.</span><span class="n">mconnectTo</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">tz</span><span class="p">)</span>
        <span class="n">delobj</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>

<span class="n">p</span> <span class="o">=</span> <span class="n">Node</span><span class="p">(</span><span class="s">&quot;persp&quot;</span><span class="p">)</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">Transform</span><span class="p">()</span>
<span class="k">assert</span> <span class="ow">not</span> <span class="n">p</span><span class="o">.</span><span class="n">tx</span><span class="o">.</span><span class="n">misConnectedTo</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">tz</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">t</span><span class="o">.</span><span class="n">isValid</span><span class="p">()</span> <span class="ow">and</span> <span class="n">t</span><span class="o">.</span><span class="n">isAlive</span><span class="p">()</span>
<span class="n">undoable_func</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">p</span><span class="o">.</span><span class="n">tx</span><span class="o">.</span><span class="n">misConnectedTo</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">tz</span><span class="p">)</span>
<span class="k">assert</span> <span class="ow">not</span> <span class="n">t</span><span class="o">.</span><span class="n">isValid</span><span class="p">()</span> <span class="ow">and</span> <span class="n">t</span><span class="o">.</span><span class="n">isAlive</span><span class="p">()</span>

<span class="n">cmds</span><span class="o">.</span><span class="n">undo</span><span class="p">()</span>
<span class="k">assert</span> <span class="ow">not</span> <span class="n">p</span><span class="o">.</span><span class="n">tx</span><span class="o">.</span><span class="n">misConnectedTo</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">tz</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">t</span><span class="o">.</span><span class="n">isValid</span><span class="p">()</span> <span class="ow">and</span> <span class="n">t</span><span class="o">.</span><span class="n">isAlive</span><span class="p">()</span>
</pre></div>
</div>
<p>Whenever non-overridden MFnFunctions are called, these will not support undo by default unless it gets implemented specifically within MRV.</p>
<p>It is planned to improve this in <a class="reference external" href="../roadmap.html"><em>future releases</em></a>.</p>
<div class="section" id="recording-your-changes">
<h2>Recording your Changes<a class="headerlink" href="#recording-your-changes" title="Permalink to this headline">¶</a></h2>
<p>MRV keeps an own undo stack for its undoable commands which integrates itself with maya&#8217;s undo queue using a custom MEL command. Effectively it records every change on that stack, once the main undoable method completes, the stack is moved onto maya&#8217;s own undo queue.</p>
<p>This allows for interesting uses considering that you can, at any time undo, your own doing in a controlled and safe fashion. This can be very useful to prepare a scene for export by changing it, and then undo your changes once you are done. This way, the user wouldn&#8217;t have to reload the ( possibly huge ) scene:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">mrv.maya.undo</span> <span class="kn">as</span> <span class="nn">undo</span>
<span class="n">ur</span> <span class="o">=</span> <span class="n">undo</span><span class="o">.</span><span class="n">UndoRecorder</span><span class="p">()</span>
<span class="n">ur</span><span class="o">.</span><span class="n">startRecording</span><span class="p">()</span>
<span class="n">p</span><span class="o">.</span><span class="n">tx</span><span class="o">.</span><span class="n">mconnectTo</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">ty</span><span class="p">)</span>
<span class="n">p</span><span class="o">.</span><span class="n">tx</span><span class="o">.</span><span class="n">mconnectTo</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">tz</span><span class="p">)</span>
<span class="n">ur</span><span class="o">.</span><span class="n">stopRecording</span><span class="p">()</span>
<span class="n">p</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">mconnectTo</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">t</span><span class="p">)</span>

<span class="k">assert</span> <span class="n">p</span><span class="o">.</span><span class="n">tx</span><span class="o">.</span><span class="n">misConnectedTo</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">ty</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">p</span><span class="o">.</span><span class="n">tx</span><span class="o">.</span><span class="n">misConnectedTo</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">tz</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">p</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">misConnectedTo</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">t</span><span class="p">)</span>
<span class="n">ur</span><span class="o">.</span><span class="n">undo</span><span class="p">()</span>
<span class="k">assert</span> <span class="ow">not</span> <span class="n">p</span><span class="o">.</span><span class="n">tx</span><span class="o">.</span><span class="n">misConnectedTo</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">ty</span><span class="p">)</span>
<span class="k">assert</span> <span class="ow">not</span> <span class="n">p</span><span class="o">.</span><span class="n">tx</span><span class="o">.</span><span class="n">misConnectedTo</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">tz</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">p</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">misConnectedTo</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">t</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <h3><a href="../index.html">Table Of Contents</a></h3>
            <ul>
<li><a class="reference external" href="#">Undo</a><ul>
<li><a class="reference external" href="#recording-your-changes">Recording your Changes</a></li>
</ul>
</li>
</ul>

            <h4>Previous topic</h4>
            <p class="topless"><a href="scenes.html"
                                  title="previous chapter">Scene Handling</a></p>
            <h4>Next topic</h4>
            <p class="topless"><a href="persistence.html"
                                  title="next chapter">Persistence</a></p>
            <h3>This Page</h3>
            <ul class="this-page-menu">
              <li><a href="../_sources/usage/undo.txt"
                     rel="nofollow">Show Source</a></li>
            </ul>
          <div id="searchbox" style="display: none">
            <h3>Quick search</h3>
              <form class="search" action="../search.html" method="get">
                <input type="text" name="q" size="18" />
                <input type="submit" value="Go" />
                <input type="hidden" name="check_keywords" value="yes" />
                <input type="hidden" name="area" value="default" />
              </form>
              <p class="searchtip" style="font-size: 90%">
              Enter search terms or a module, class or function name.
              </p>
          </div>
          <script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../modindex.html" title="Global Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="persistence.html" title="Persistence"
             >next</a> |</li>
        <li class="right" >
          <a href="scenes.html" title="Scene Handling"
             >previous</a> |</li>
        <li><a href="../index.html">mrv v1.0.1-develop documentation</a> &raquo;</li>
          <li><a href="index.html" >Usage</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
      &copy; Copyright Sebastian Thiel.
      Last updated on Nov 30, 2010.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 0.6.5.
    </div>
  </body>
</html>